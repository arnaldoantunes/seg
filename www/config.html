<!DOCTYPE html>
<html>
    <head>
	
		<meta name="format-detection" content="telephone=no">
        <meta charset="utf-8">
        <meta name="msapplication-tap-highlight" content="no">
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
        <link rel="stylesheet" type="text/css" href="css/index.css">
		<link rel="stylesheet" type="text/css" href="mobileui/style.css">
		<script type="text/javascript" src="mobileui/mobileui.js"></script>
		<script type="text/javascript" src="js/soapclient.js"></script>
        <title>HomeESP</title>
		<script type = "text/javascript">
			window.disabledOpenPageEffect=true
			var ws = null;
			function inicial(){
			    var ip = localStorage.getItem("IP");
				var ipexterno = localStorage.getItem("IPEXTERNO");
				var usarExterno = localStorage.getItem("EXTERNO");
				if (usarExterno == '1') {document.getElementById("usarExterno").checked = true; if (ipexterno != ''){ip = ipexterno;}}else {document.getElementById("usarExterno").checked = false;}
				document.getElementById("IPexterno").value = localStorage.getItem("IPEXTERNO");
				document.getElementById("status").innerHTML = "Desconectado";
				ws = new WebSocket('ws://'+ip+'/test');
				ws.onopen = function() {
					ws.send("A0");
					document.getElementById("status").innerHTML = "Conectado";
				};
				ws.onmessage = function(evt){
				   var received_msg = evt.data;
				   var clienteID = received_msg.substring(8,17);
				   document.getElementById("IDCliente").value = clienteID;
				};
			    document.getElementById("text1").value = localStorage.getItem("IP");
			}
			function volta(){window.location.href = "index.html";}
			function atualiza(){inicial();}
			function guardaIP(){localStorage.setItem("IP", document.getElementById("text1").value);}
			function guardaIDCLIENTE(){
				var ch = document.getElementById("IDCliente");
				ws.send("E"+ch.value);
			}
			
			function chamaIP() {
				function getIp(callback){
					function response(s){callback(window.userip);s.onload = s.onerror = null;document.body.removeChild(s);}
					function trigger(){
							window.userip = false;
							var s = document.createElement("script");
							s.async = true;
							s.onload = function() {response(s);};s.onerror = function() {response(s);};
							s.src = "https://l2.io/ip.js?var=userip";
							document.body.appendChild(s);
					}
					if (/^(interactive|complete)$/i.test(document.readyState)) {trigger();} else {document.addEventListener('DOMContentLoaded', trigger);}
				}
				getIp(function (ip){document.getElementById("IPexterno").value = ip; localStorage.setItem("IPEXTERNO", ip);});
			}
			function usarIP(){if (usarExterno.checked){localStorage.setItem("EXTERNO", "1");}else {localStorage.setItem("EXTERNO", "0");}}
			function recarrega(){
				//window.location.reload();
    			recuperaID();
			}
			
			
			var url = "http://localhost:51844/Novo/TestService.asmx";
            function recuperaID(){
		        carregaEstado();
				
	        }
	        function recuperaID_callBack(result){
			   
			}
			
			function carregaEstado(){
				var pl = new SOAPClientParameters();
		        SOAPClient.invoke(url, "pegaEstado", pl, true, carregaEstado_callBack);
			}
			function carregaEstado_callBack(result){
			    var obj = JSON.parse(result); var select = document.getElementById("estado"); var n;
				for (n = 0; n < obj.length; n++){select.options[select.options.length] = new Option(obj[n].p_DS_ESTADO, obj[n].p_CD_ESTADO, false, false);}
			}
			
			function selecionaCidade(){
				var select = document.getElementById("estado");
				var option = select.options[select.selectedIndex];
				alert("Text: " + option.text + "\nValue: " + option.value);
			}
			
			
			
		</script>	
    </head>

    <body onload="inicial();">
		<div class="header blue-900">
			<button class="left icon ion-android-arrow-back" onclick="volta()" name="button"></button>
			<h1 class="align-center" style="color:#9eb5d9">Configuração</h1>
		</div>		
		<div class="header blue-900 sub shadow tab">
			<button class="icon ion-wifi active" onclick="openCity1(event, 'tabRede')">Rede</button>
			<button class="icon ion-ios-cloud" onclick="openCity1(event, 'tabCliente')">Monitoramento</button>
		</div>
		<div class="tab-content active" id="tabRede">
			</br></br></br></br></br></br></br></br>
			<div class="list">
				<div class="item">
					<h2>IP local</h2>
					<div class="right">
						<input type="text" id="text1" onchange="guardaIP();">
					</div>
				</div>
			</div>
			<div class="list">
				<div class="item">
					<button onclick="chamaIP();" class="border-grey radius icon-text"><i class="icon icon ion-refresh"></i>IP Externo</button>
					<div class="right">
						<input type="text" id="IPexterno">
					</div>
				</div>
			</div>
			<div class="list">
				<div class="item">
					<h2>Usar IP externo</h2>
					<div class="right">
						<input type="checkbox" class="switch green" id="usarExterno" onchange="usarIP();" >
					</div>
				</div>	
			</div>	
		</div>
		<div class="tab-content" id="tabCliente">
			</br></br></br></br></br></br></br></br>
			<div class="list">
				<div class="item">
					<h2>ID do cliente</h2>
					<div class="right">
						<input type="text" id="IDCliente" onchange="guardaIDCLIENTE();">
					</div>
				</div>
			</div>	
			<div class="list">
				<div class="item">
					<h1>Para obter a ID do cliente acesse Meus Dados e faça o cadastro.</h1>
				</div>
			</div>	
			<div class="list">
				<div class="item">
					<button class="grey-200 full radius margin-top margin-bottom" onclick="openPage('dados');")>Meus Dados</button>
				</div>
			</div>

		</div>
		
		<div class="footer blue-900">
			<div class="title" style="color:#9eb5d9">
				<div id="status"></div>
			</div>
			<div class="right">
				<button onclick="atualiza();" class="icon ion-refresh" style="color:#9eb5d9"></button>
			</div>
		</div>
		<script>
			function openCity1(evt, cityName) {
				var i, tabcontent, tablinks;
				tabcontent = document.getElementsByClassName("tab-content");
				for (i = 0; i < tabcontent.length; i++) {
					tabcontent[i].style.display = "none";
				}
				tablinks = document.getElementsByClassName("icon");
				for (i = 0; i < tablinks.length; i++) {
					tablinks[i].className = tablinks[i].className.replace(" active", "");
				}
				document.getElementById(cityName).style.display = "block";
				evt.currentTarget.className += " active";
			}
		</script>

    </body>
</html>

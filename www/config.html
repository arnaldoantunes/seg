<!DOCTYPE html>
<html>
    <head>
		<meta name="format-detection" content="telephone=no">
        <meta charset="utf-8">
        <meta name="msapplication-tap-highlight" content="no">
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
        <link rel="stylesheet" type="text/css" href="css/index.css">
		<link rel="stylesheet" type="text/css" href="mobileui/style.css">
        <title>HomeESP</title>
		
		
		<script type = "text/javascript">
			var ws = null;
			function inicial(){
			    var ip = localStorage.getItem("IP");
				document.getElementById("alarme1").disabled = true;
				document.getElementById("tempo").disabled = true;
				document.getElementById("status").innerHTML = "Desconectado";
				ws = new WebSocket('ws://'+ip+'/test');
				ws.onopen = function() {
					ws.send("A0");
					document.getElementById("alarme1").disabled = false;
					document.getElementById("tempo").disabled = false;
					document.getElementById("status").innerHTML = "Conectado";
				};
				ws.onmessage = function(evt){
				   var received_msg = evt.data;
				   var estadoalarme = received_msg.substring(6,7);
				   var timealarme = received_msg.substring(7,8);
				   if (estadoalarme == '1') {document.getElementById("alarme1").checked = true;}else {document.getElementById("alarme1").checked = false;}
				   document.getElementById("tempo").value = timealarme;
				};
			    document.getElementById("text1").value = localStorage.getItem("IP");
			}
		
		
			function volta(){
				window.location.href = "index.html";
			}
			
			function funcaoalarme(){
				var ch = document.getElementById("alarme1");
				if (ch.checked){ws.send("B1");}else {ws.send("B0");}
			}
			function funcaoselect(){
				var x = document.getElementById("tempo").value;
				ws.send("C"+x);
			}
			
			function atualiza(){
			   inicial();
			}
			
			function guardaIP(){
				localStorage.setItem("IP", document.getElementById("text1").value);
			}
			
	
		</script>	
	  
		
    </head>
	

    <body onload="inicial();">
		<div class="header blue-900">
		    <button class="left icon ion-android-arrow-back" onclick="volta();" name="button"></button>
			<h1 class="align-center text-blue-200">Configuração</h1>
		</div>
		
		</br></br></br></br>
		 		
		<div class="header blue-900 sub shadow tab">
			<button class="icon ion-ios-home active" onclick="openCity(event, 'tabAlarme')">Alarme</button>
			<button class="icon ion-wifi" onclick="openCity(event, 'tabRede')">Rede</button>
			<button class="icon ion-ios-cloud" onclick="openCity(event, 'tabCliente')">ID do Cliente</button>
		</div>

		<div class="tab-content active" id="tabAlarme">
			<h2 class="text-strong padding text-pink">Alarme</h2>
			</BR>
			<div class="list">
				<div class="item">
					<h2>Alarme</h2>
					<div class="right">
						<input type="checkbox" class="switch green" id="alarme1" onchange="funcaoalarme();" >
					</div>
				</div>
				<div class="item">
					<select id="tempo" onchange="funcaoselect();">
						<option value="0">10 segundos</option>
						<option value="1">30 segundos</option>
						<option value="2">1 minuto</option>
						<option value="3">2 minutos</option>
					</select>
				</div>
			</div>
		  </div>
		  <div class="tab-content" id="tabRede">
				<h2 class="text-strong padding text-pink">Rede</h2>
				</BR>
				<div class="list">
					<div class="item">
						<h2>Endereço IP</h2>
						<div class="right">
							<input type="text" id="text1" onchange="guardaIP();">
						</div>
					</div>
				</div>
		  </div>
		  <div class="tab-content" id="tabCliente">
			<h2 class="text-strong padding text-pink">ID do Cliente</h2>
		  </div>
		 
		
		
		

		
		
		</br></br>
		<div id="result"></div>
		<div class="footer blue-900 text-blue-200">
			<div class="title">
				<div id="status"></div>
			</div>
			<div class="right">
			    <button onclick="atualiza();" class="icon ion-refresh text-blue-200"></button>
			</div>
		</div>	
		
		
		<script>
			function openCity(evt, cityName) {
				var i, tabcontent, tablinks;
				tabcontent = document.getElementsByClassName("tab-content");
				for (i = 0; i < tabcontent.length; i++) {
					tabcontent[i].style.display = "none";
				}
				tablinks = document.getElementsByClassName("icon");
				for (i = 0; i < tablinks.length; i++) {
					tablinks[i].className = tablinks[i].className.replace(" active", "");
				}
				document.getElementById(cityName).style.display = "block";
				evt.currentTarget.className += " active";
			}
		</script>

    </body>
</html>

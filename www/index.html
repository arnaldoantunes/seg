<!DOCTYPE html>
<html>
    <head>
    
        <meta name="format-detection" content="telephone=no">
        <meta charset="utf-8">
        <meta name="msapplication-tap-highlight" content="no">
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
        <link rel="stylesheet" type="text/css" href="css/index.css">
		<link rel="stylesheet" type="text/css" href="mobileui/style.css">
        <title>HomeESP</title>
		<audio id="myAudio"><source src="sirene.mp3" type="audio/mpeg"></audio>
        <script type="text/javascript" src="mobileui/mobileui.js"></script>
		<!--<script type="text/javascript" src="js/cordova.js"></script>
		<script type="text/javascript" src="js/index.js"></script>-->
		
		<style>
			.switch {
			  position: relative;
			  display: inline-block;
			  width: 60px;
			  height: 34px;
			}

			.switch input { 
			  opacity: 0;
			  width: 0;
			  height: 0;
			}

			.slider {
			  position: absolute;
			  cursor: pointer;
			  top: 0;
			  left: 0;
			  right: 0;
			  bottom: 0;
			  background-color: #ccc;
			  -webkit-transition: .4s;
			  transition: .4s;
			}

			.slider:before {
			  position: absolute;
			  content: "";
			  height: 26px;
			  width: 26px;
			  left: 4px;
			  bottom: 4px;
			  background-color: white;
			  -webkit-transition: .4s;
			  transition: .4s;
			}

			input:checked + .slider {
			  background-color: #2196F3;
			}

			input:focus + .slider {
			  box-shadow: 0 0 1px #2196F3;
			}

			input:checked + .slider:before {
			  -webkit-transform: translateX(26px);
			  -ms-transform: translateX(26px);
			  transform: translateX(26px);
			}

			/* Rounded sliders */
			.slider.round {
			  border-radius: 34px;
			}

			.slider.round:before {
			  border-radius: 50%;
			}
		</style>
		
		<script type = "text/javascript">
			var ws = null;
			function OpenWebsocket() {
			    var ip = localStorage.getItem("IP");
				document.getElementById("chk1").disabled = true;
				document.getElementById("chk2").disabled = true;
				document.getElementById("chk3").disabled = true;
				document.getElementById("chk4").disabled = true;
				document.getElementById("chk5").disabled = true;
				document.getElementById("chk6").disabled = true;
				document.getElementById("status").innerHTML = "Desconectado";
				ws = new WebSocket('ws://'+ip+'/test');
				ws.onopen = function() {
					ws.send("A0");
					document.getElementById("chk1").disabled = false;
					document.getElementById("chk2").disabled = false;
					document.getElementById("chk3").disabled = false;
					document.getElementById("chk4").disabled = false;
					document.getElementById("chk5").disabled = false;
					document.getElementById("chk6").disabled = false;
					document.getElementById("status").innerHTML = "Conectado";
				};
				ws.onmessage = function(evt){
				   var received_msg = evt.data;
				   acertaEstados(received_msg);
				};
				ws.onclose = function() {
					document.getElementById("chk1").disabled = true;
					document.getElementById("chk2").disabled = true;
					document.getElementById("chk3").disabled = true;
					document.getElementById("chk4").disabled = true;
					document.getElementById("chk5").disabled = true;
					document.getElementById("chk6").disabled = true;
					document.getElementById("status").innerHTML = "Desconectado";
				};
			}
			
			function acertaEstados(estado){
				   var estado1 = estado.substring(0,1);
				   var estado2 = estado.substring(1,2);
				   var estado3 = estado.substring(2,3);
				   var estado4 = estado.substring(3,4);
				   var estado5 = estado.substring(4,5);
				   var estado6 = estado.substring(5,6);
				   if (estado1 == '1') {document.getElementById("chk1").checked = true;}else {document.getElementById("chk1").checked = false;}
				   if (estado2 == '1') {document.getElementById("chk2").checked = true;}else {document.getElementById("chk2").checked = false;}
				   if (estado3 == '1') {document.getElementById("chk3").checked = true;}else {document.getElementById("chk3").checked = false;}
				   if (estado3 == '1') {document.getElementById("chk4").checked = true;}else {document.getElementById("chk4").checked = false;}
				   if (estado3 == '1') {document.getElementById("chk5").checked = true;}else {document.getElementById("chk5").checked = false;}
				   if (estado3 == '1') {document.getElementById("chk6").checked = true;}else {document.getElementById("chk6").checked = false;}
			}
	 
			function CloseWebsocket(){
				ws.close();
			}

			function SendData(){
				//var textToSend = document.getElementById("inputText").value;
				//ws.send(textToSend);
			}
			 
			function f1(){
				 var ch = document.getElementById("chk1");
				 if (ch.checked){ws.send("11");}else {ws.send("10");}
			}
			function f2(){
				 var ch = document.getElementById("chk2");
				 if (ch.checked){ws.send("21");}else {ws.send("20");}
			}
			function f3(){
				 var ch = document.getElementById("chk3");
				 if (ch.checked){ws.send("31");}else {ws.send("30");}	    
			}
			function f4(){
				 var ch = document.getElementById("chk4");
				 if (ch.checked){ws.send("41");}else {ws.send("40");}	    
			}
			function f5(){
				 var ch = document.getElementById("chk5");
				 if (ch.checked){ws.send("51");}else {ws.send("50");}	    
			}
			
			function f6(){
				 var ch = document.getElementById("chk6");
				 if (ch.checked){ws.send("61");}else {ws.send("60");}	    
			}			
			
		
			function atualiza(){
			   OpenWebsocket();
			}
			
			var x = document.getElementById("myAudio");
			function playAudio() {
			 // x.play();
			}
			
				 
		  </script>
	  
		
    </head>
	

    <body onload="OpenWebsocket();">
	
	
	
		<div class="popover" id="popover1">
			<div class="list">
			   <div class="item"><a href="config.html" class="text-grey">Configuração</a></div>
			   <div class="item"><a href="#" onclick="alert('HomeESP<BR><BR>App de Automação</BR>Versão 1.0');" class="text-grey">Sobre</a></div>
			</div>
	    </div>

		<div class="header blue-900">
			<h1 class="align-center text-blue-200">HomeESP</h1>
			<div class="right">
			  <button class="icon ion-android-more-vertical" onclick="openPopover('popover1')"></button>
			</div>
		</div>
		
		</br></br></br></br>
		 <div class="list">
				  <div class="item">
					<h2>Muro</h2>
					<div class="right">
					  <input type="checkbox" class="switch green" id="chk1" onchange="f1();" >
					</div>
				  </div>
				 
				  <div class="item">
					<h2>Torre</h2>
					<div class="right">
					  <input type="checkbox" class="switch green" id="chk2" onchange="f2();">
					</div>
				  </div>
				
				  <div class="item">
					<h2>Suite</h2>
					<div class="right">
					  <input type="checkbox" class="switch green" id="chk3" onchange="f3();">
					</div>
				  </div>
				  <div class="item">
					<h2>Churrasqueira</h2>
					<div class="right">
					  <input type="checkbox" class="switch green" id="chk4" onchange="f4();">
					</div>
				  </div>

				  <div class="item">
					<h2>Quarto João</h2>
					<div class="right">
					  <input type="checkbox" class="switch green" id="chk5" onchange="f5();">
					</div>
				  </div>				  
				  
			      <div class="item">
					<h2>Quarto Julio</h2>
					<div class="right">
					  <input type="checkbox" class="switch green" id="chk6" onchange="f6();">
					</div>
				  </div>				  				  
				</div>
		
		
		</br></br>
		<div id="result"></div>
		<div class="footer blue-900">
			<div class="title text-blue-200">
				<div id="status"></div>
			</div>
			<div class="right">
			    <button onclick="atualiza();" class="icon ion-refresh text-blue-200"></button>
			</div>
		</div>	
    </body>
</html>
